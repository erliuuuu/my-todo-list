<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„æ¸…å• - æœ€ç»ˆä¿®å¤ç‰ˆ</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f4; display: flex; justify-content: center; padding: 50px; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 300px; }
        input { padding: 8px; width: 70%; border: 1px solid #ddd; border-radius: 4px; }
        .add-btn { padding: 8px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        ul { list-style: none; padding: 0; margin-top: 20px; }
        li { background: #eee; margin-bottom: 5px; padding: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 4px; }
        .completed { text-decoration: line-through; color: #888; opacity: 0.6; }
        li span { cursor: pointer; flex-grow: 1; }
        .del-btn { background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ æˆ‘çš„å¾…åŠäº‹é¡¹</h1>
        <input type="text" id="todoInput" placeholder="ä»Šå¤©è¦åšç‚¹ä»€ä¹ˆï¼Ÿ">
        <button class="add-btn" id="realAddBtn">æ·»åŠ ä»»åŠ¡</button>
        <ul id="todoList"></ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // é…ç½®ä¿¡æ¯
        const SUPABASE_URL = 'https://pyoswqkqvhxlbgwjezia.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_20Sd5qBbpSXzRQIK0AmHNw_RuwwKUqd';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // åˆå§‹åŒ–åŠ è½½
        window.onload = async () => {
            const { data } = await supabaseClient.from('todos').select('*').order('id', { ascending: true });
            if (data) data.forEach(item => createTaskElement(item.task, item.id, item.is_done));
        };

        // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆä¸ç”¨ onclickï¼Œæ”¹ç”¨æ›´ç¨³çš„ç›‘å¬å™¨ï¼‰
        document.getElementById('realAddBtn').addEventListener('click', async () => {
            const input = document.getElementById("todoInput");
            const text = input.value.trim();
            if (!text) return alert("å†™ç‚¹ä»€ä¹ˆå§");

            // è¿™é‡Œçš„è§£æ„å¿…é¡»æ­£ç¡®
            const { data, error } = await supabaseClient
                .from('todos')
                .insert([{ task: text, is_done: false }])
                .select();

            if (error) {
                alert("äº‘ç«¯æŠ¥é”™: " + error.message);
            } else if (data && data.length > 0) {
                createTaskElement(text, data[0].id, false);
                input.value = "";
            }
        });

        // åˆ‡æ¢å®ŒæˆçŠ¶æ€
        async function toggleDone(id, span) {
            const isDone = !span.classList.contains('completed');
            span.classList.toggle('completed');
            await supabaseClient.from('todos').update({ is_done: isDone }).eq('id', id);
        }

        // åˆ é™¤ä»»åŠ¡
        async function deleteTask(id, btn) {
            const { error } = await supabaseClient.from('todos').delete().eq('id', id);
            if (!error) btn.parentElement.remove();
        }

        // æ¸²æŸ“ HTML
        function createTaskElement(text, id, isDone) {
            const ul = document.getElementById("todoList");
            const li = document.createElement("li");
            const doneClass = isDone ? 'class="completed"' : '';
            li.innerHTML = `
                <span ${doneClass} onclick="toggleDone('${id}', this)">${text}</span>
                <button class="del-btn" onclick="deleteTask('${id}', this)">åˆ é™¤</button>
            `;
            ul.appendChild(li);
        }
    </script>
</body>
</html>